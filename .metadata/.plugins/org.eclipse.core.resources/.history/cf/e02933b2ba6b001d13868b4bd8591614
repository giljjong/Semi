<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gdu.semi.mapper.UploadBoardMapper">
	
	<select id="selectUploadList" resultType="UploadBoardDTO">
		SELECT U.UPLOAD_BOARD_NO, U.ID, U.UPLOAD_TITLE, U.UPLOAD_CONTENT, U.IP, U.CREATE_DATE, U.MODIFY_DATE, U.HIT,
		(SELECT COUNT(*) FROM ATTACH A WHERE U.UPLOAD_BOARD_NO = A.UPLOAD_BOARD_NO) AS ATTACH_CTN
		FROM UPLOAD_BOARD U
	</select>
	
	<update id="updateHit" parameterType="int">
		UPDATE UPLOAD_BOARD
			SET HIT = HIT + 1
		WHERE UPLOAD_BOARD_NO = #{uploadBoardNo}
	</update>
	
	 <insert id="insertUpload" parameterType="UploadBoardDTO">
		<selectKey keyProperty="uploadBoardNo" resultType="int" order="BEFORE">
			SELECT UPLOAD_SEQ.NEXTVAL
				FROM DUAL
		</selectKey>
		INSERT INTO UPLOAD_BOARD
			(UPLOAD_BOARD_NO, ID, IP, UPLOAD_TITLE, UPLOAD_CONTENT, CREATE_DATE, MODIFY_DATE, HIT )
		VALUES
			(#{uploadBoardNo}, #{id}, #{ip}, #{uploadTitle}, #{uploadContent}, SYSDATE, SYSDATE, 0)
		
	</insert>  
	
	<insert id="insertAttach" parameterType="AttachDTO">
		INSERT INTO ATTACH
			(ATTACH_NO, PATH, ORIGIN, FILESYSTEM, DOWNLOAD_CNT, UPLOAD_BOARD_NO)
		VALUES
			(ATTACH_SEQ.NEXTVAL, #{path}, #{origin}, #{filesystem}, 0, #{uploadBoardNo})
	</insert>  
	
	<select id="selectUploadByNo" parameterType="int" resultType="UploadBoardDTO" >
		SELECT UPLOAD_BOARD_NO, ID, IP, UPLOAD_TITLE, UPLOAD_CONTENT, CREATE_DATE, MODIFY_DATE, HIT 
		FROM UPLOAD_BOARD
		WHERE UPLOAD_BOARD_NO = #{uploadBoardNo}
	</select>
	
	<select id="selectAttachList" parameterType="int" resultType="AttachDTO">
		SELECT ATTACH_NO, PATH, ORIGIN, FILESYSTEM, DOWNLOAD_CNT, UPLOAD_BOARD_NO
		FROM ATTACH
		WHERE UPLOAD_BOARD_NO = #{uploadBoardNo}
	</select> 
	
	<update id="updateDownloadCnt" parameterType="int">
		UPDATE ATTACH
			SET DOWNLOAD_CNT = DOWNLOAD_CNT + 1
		WHERE ATTACH_NO = #{attachNo}
	</update>
	

	
	<!-- <update id="updatePoint" parameterType="int">
		UPDATE UPLOAD_BOARD
		형꺼 Dto 받아오기
	</update> -->
	
	<select id="selectAttachByNo" parameterType="int" resultType="AttachDTO">
		SELECT ATTACH_NO, PATH, ORIGIN, FILESYSTEM, DOWNLOAD_CNT, UPLOAD_BOARD_NO
			FROM ATTACH
		WHERE UPLOAD_BOARD_NO = ${upload_board_no}
	</select>
	
	
</mapper>