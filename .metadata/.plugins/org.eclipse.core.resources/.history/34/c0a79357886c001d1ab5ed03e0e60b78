<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<c:set var="contextPath" value="${pageContext.request.contextPath}"></c:set>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="${contextPath}/resources/js/jquery-3.6.1.min.js"></script>
<script>

	$(document).ready(function(){
		fn_autoList();
	});

	function fn_autoList(){
		$('#userList').empty();
		$.ajax({
			type : 'get',
			url : '${contextPath}/admin/list/allUsers',
			dataType : 'json',
			success : function(resData) {
				
				console.log(resData);
				
				$('<span>').html('총 인원 수 : ' + resData.totalRecord)
				.append($('<span>').html('휴면 회원 : ' + resData.sleepUserCnt))
				.appendTo('#span_cnt');
				
				$('.pageWrap').html(resData.paging);
				
				if(resData.status == 200) {
					console.log(resData.users[0].userDTO.userNo);
					$.each(resData.users, function(i, user){

						$('<tr>')
						.append($('<td>').html(user.userDTO.userNo))
						.append($('<td>').html(user.userDTO.id))
						.append(user.sleepUserDTO.sleepDate == null ? $('<td>').html('정상회원') : $('<td>').html('휴면회원'))
						.append($('<td>').html(user.userDTO.point))
						.append($('<td>').html(user.userDTO.snsType))
						.append($('<td>').html(user.userDTO.joinDate))
						.append($('<td>').html(user.userDTO.accessLogDTO.lastLoginDate))
						.append(user.sleepUserDTO.sleepDate == null ? tr.append($('<td>').html('')) : $('<td>').html('휴면회원'))
						.append($('<td>').html(<a href="${contextPath}/admin/user/retire"><i class="fa-solid fa-trash-can"></i></a>))
						.appendTo($('#userList'));
						
						// tr
						// .append($('<td>').html(user.userDTO.point))
						// .append($('<td>').html(user.userDTO.snsType))
						// .append($('<td>').html(user.userDTO.joinDate))
						// .append($('<td>').html(user.userDTO.accessLogDTO.lastLoginDate));
						// if(user.sleepUserDTO.sleepDate == null){
						// 	tr.append($('<td>').html(user.sleepUserDTO.sleepDate))
						// } else{
						// 	tr.append($('<td>').html(''))
						// }
						// tr.appendTo($('#list'));
					});
				} else {
					alert(resData.message);
				}
			}
		});
	};
</script>
</head>
<body>
	<div>
		<a href="${contextPath}/admin/list/free">자유게시판 관리</a>
		<a href="${contextPath}/admin/list/gallery">갤러리게시판 관리</a>
		<a href="${contextPath}/admin/list/upload">업로드게시판 관리</a>
	</div>
	<div>
		<div id="span_cnt">
		</div>
		<table border="1">
			<thead>
				<tr>
					<td>순번</td>
					<td>아이디</td>
					<td>상태</td>
					<td>포인트</td>
					<td>가입종류</td>
					<td>가입일</td>
					<td>마지막접속일</td>
					<td>휴면날짜</td>
					<td>강제탈퇴</td>
				</tr>
			</thead>
			<tbody id="userList">
			<%-- 	<c:forEach items="${users}" var="user">
					<tr>
						<td>${user.userDTO.userNo}</td>
						<td>${user.userDTO.id}</td>
						<c:if test="${user.sleepUserDTO.sleepDate != null}">
							<td>휴면회원</td>
						</c:if>
						<c:if test="${user.sleepUserDTO.sleepDate == null}">
							<td>정상회원</td>
						</c:if>
						<td>${user.userDTO.point}</td>
						<td>${user.userDTO.snsType}</td>
						<td>${user.userDTO.joinDate}</td>
						<td>${user.userDTO.accessLogDTO.lastLoginDate}</td>
						<c:if test="${user.sleepUserDTO.sleepDate != null}">
							<td>${user.sleepUserDTO.sleepDate}</td>
						</c:if>
						<c:if test="${user.sleepUserDTO.sleepDate == null}">
							<td> </td>
						</c:if>
						<td><a href="${contextPath}/admin/user/retire"><i class="fa-solid fa-trash-can"></i></a></td>
					</tr>
				</c:forEach> --%>
			</tbody>
		</table>
		<div class="paginate">
			<div class="pageWrap">
				${paging}
			</div>
		</div>
	</div>
</body>
</html>